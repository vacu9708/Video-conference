{"ast":null,"code":"import _toConsumableArray from\"G:/Software/github/video-conference/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"G:/Software/github/video-conference/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import Messages from'../components/Messages';import My_websocket from'../my_websocket';import Streams from'../components/Streams';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Room=function Room(){var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),input_msg=_React$useState2[0],set_input_msg=_React$useState2[1];var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),participants=_React$useState4[0],set_participants=_React$useState4[1];var _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),messages=_React$useState6[0],set_messages=_React$useState6[1];var messages_ref=React.useRef([]);var message_window=React.useRef();var ws=React.useMemo(function(){return new My_websocket(\"wss://\".concat(window.location.hostname));},[]);React.useEffect(function(){// Find roomID\nvar url=window.location.href;var p=url.length-1;while(url[p]!=='/'){p--;}sessionStorage.setItem('roomID',url.substring(p+1,url.length));ws.on('err',function(json){// window.location.reload()\nalert('Multiple connections not allowed!');console.log(json);});ws.on('participant',function(json){set_participants(json.participants.split('/'));json={target:json.target,name:json.name,msg:json.msg};messages_ref.current=[].concat(_toConsumableArray(messages_ref.current),[json]);set_messages(messages_ref.current);});ws.on('chat_msg',function(json){json={target:json.target,name:json.name,msg:json.msg};messages_ref.current=[].concat(_toConsumableArray(messages_ref.current),[json]);set_messages(messages_ref.current);});var interval=setInterval(function(){if(ws.is_open){ws.send(JSON.stringify({target:\"join_room\",name:sessionStorage.getItem('name'),roomID:sessionStorage.getItem('roomID')}));clearInterval(interval);}},1);},[]);React.useEffect(function(){message_window.current.scrollTop=message_window.current.scrollHeight;},[messages]);var send_msg=function send_msg(e){if(e.key!=='Enter')return;e.preventDefault();ws.send(JSON.stringify({target:'chat_msg',msg:input_msg}));set_input_msg('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"room_frame\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"left_window\",style:{fontSize:'50px',textAlign:'center'},children:ws.is_open?/*#__PURE__*/_jsx(Streams,{ws:ws}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat_window\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat_header\",children:[\"Chat\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"participants\",children:participants})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message_window\",ref:message_window,children:/*#__PURE__*/_jsx(Messages,{messages:messages})}),/*#__PURE__*/_jsx(\"textarea\",{className:\"msg_input\",onChange:function onChange(e){return set_input_msg(e.target.value);},onKeyDown:send_msg,placeholder:\"target message here\",value:input_msg})]})]});};export default Room;","map":{"version":3,"names":["React","Messages","My_websocket","Streams","Room","useState","input_msg","set_input_msg","participants","set_participants","messages","set_messages","messages_ref","useRef","message_window","ws","useMemo","window","location","hostname","useEffect","url","href","p","length","sessionStorage","setItem","substring","on","json","alert","console","log","split","target","name","msg","current","interval","setInterval","is_open","send","JSON","stringify","getItem","roomID","clearInterval","scrollTop","scrollHeight","send_msg","e","key","preventDefault","fontSize","textAlign","value"],"sources":["G:/Software/github/video-conference/client/src/pages/Room.tsx"],"sourcesContent":["import React from \"react\";\r\nimport Messages from '../components/Messages'\r\nimport {Msg} from '../components/Messages'\r\nimport My_websocket from '../my_websocket'\r\nimport Streams from '../components/Streams'\r\n\r\nconst Room = () => {\r\n  const [input_msg, set_input_msg] = React.useState(\"\");\r\n  const [participants, set_participants] = React.useState<string[]>([])\r\n  const [messages, set_messages]=React.useState<Msg[]>([])\r\n  const messages_ref=React.useRef<Msg[]>([])\r\n  const message_window=React.useRef<any>()\r\n  const ws=React.useMemo(()=>new My_websocket(`wss://${window.location.hostname}`),[])\r\n\r\n  React.useEffect(()=>{\r\n    // Find roomID\r\n    let url=window.location.href\r\n    let p=url.length-1\r\n    while(url[p]!=='/') p--\r\n    sessionStorage.setItem('roomID', url.substring(p+1, url.length))\r\n\r\n    ws.on('err', (json: any)=>{\r\n      // window.location.reload()\r\n      alert('Multiple connections not allowed!')\r\n      console.log(json)\r\n    })\r\n    ws.on('participant', (json: any)=>{\r\n      set_participants(json.participants.split('/'))\r\n      json={target: json.target, name: json.name, msg: json.msg}\r\n      messages_ref.current=[...messages_ref.current, json]\r\n      set_messages(messages_ref.current)\r\n    })\r\n    ws.on('chat_msg', (json: any)=>{\r\n      json={target: json.target, name: json.name, msg: json.msg}\r\n      messages_ref.current=[...messages_ref.current, json]\r\n      set_messages(messages_ref.current)\r\n    })\r\n    const interval=setInterval(()=>{\r\n      if(ws.is_open){\r\n        ws.send(JSON.stringify({target: \"join_room\", name: sessionStorage.getItem('name'), roomID: sessionStorage.getItem('roomID')}))\r\n        clearInterval(interval)\r\n      }\r\n    }, 1)\r\n  },[])\r\n\r\n  React.useEffect(()=>{\r\n    message_window.current.scrollTop = message_window.current.scrollHeight\r\n  },[messages])\r\n\r\n  const send_msg=(e: any)=>{\r\n    if(e.key!=='Enter')\r\n      return\r\n    e.preventDefault()\r\n    ws.send(JSON.stringify({target: 'chat_msg', msg: input_msg}))\r\n    set_input_msg('')\r\n  }\r\n\r\n  return(\r\n    <div className=\"room_frame\">\r\n      <div className=\"left_window\" style={{fontSize: '50px', textAlign: 'center'}}>\r\n        {ws.is_open? <Streams ws={ws}/>: <></>}\r\n      </div>\r\n      <div className=\"chat_window\">\r\n        <div className=\"chat_header\">\r\n          Chat<br/>\r\n          <div className='participants'>{participants}</div>\r\n        </div>\r\n        <div className=\"message_window\" ref={message_window}>\r\n          <Messages messages={messages}/>\r\n        </div>\r\n        <textarea className=\"msg_input\" onChange={\r\n          (e) => set_input_msg(e.target.value)} onKeyDown={send_msg} placeholder='target message here' value={input_msg} />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\nexport default Room;"],"mappings":"wQAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,MAAOC,SAAQ,KAAM,wBAAwB,CAE7C,MAAOC,aAAY,KAAM,iBAAiB,CAC1C,MAAOC,QAAO,KAAM,uBAAuB,8IAE3C,GAAMC,KAAI,CAAG,QAAPA,KAAI,EAAS,CACjB,oBAAmCJ,KAAK,CAACK,QAAQ,CAAC,EAAE,CAAC,oDAA9CC,SAAS,qBAAEC,aAAa,qBAC/B,qBAAyCP,KAAK,CAACK,QAAQ,CAAW,EAAE,CAAC,qDAA9DG,YAAY,qBAAEC,gBAAgB,qBACrC,qBAA+BT,KAAK,CAACK,QAAQ,CAAQ,EAAE,CAAC,qDAAjDK,QAAQ,qBAAEC,YAAY,qBAC7B,GAAMC,aAAY,CAACZ,KAAK,CAACa,MAAM,CAAQ,EAAE,CAAC,CAC1C,GAAMC,eAAc,CAACd,KAAK,CAACa,MAAM,EAAO,CACxC,GAAME,GAAE,CAACf,KAAK,CAACgB,OAAO,CAAC,iBAAI,IAAId,aAAY,iBAAUe,MAAM,CAACC,QAAQ,CAACC,QAAQ,EAAG,GAAC,EAAE,CAAC,CAEpFnB,KAAK,CAACoB,SAAS,CAAC,UAAI,CAClB;AACA,GAAIC,IAAG,CAACJ,MAAM,CAACC,QAAQ,CAACI,IAAI,CAC5B,GAAIC,EAAC,CAACF,GAAG,CAACG,MAAM,CAAC,CAAC,CAClB,MAAMH,GAAG,CAACE,CAAC,CAAC,GAAG,GAAG,EAAEA,CAAC,EAAE,EACvBE,cAAc,CAACC,OAAO,CAAC,QAAQ,CAAEL,GAAG,CAACM,SAAS,CAACJ,CAAC,CAAC,CAAC,CAAEF,GAAG,CAACG,MAAM,CAAC,CAAC,CAEhET,EAAE,CAACa,EAAE,CAAC,KAAK,CAAE,SAACC,IAAS,CAAG,CACxB;AACAC,KAAK,CAAC,mCAAmC,CAAC,CAC1CC,OAAO,CAACC,GAAG,CAACH,IAAI,CAAC,CACnB,CAAC,CAAC,CACFd,EAAE,CAACa,EAAE,CAAC,aAAa,CAAE,SAACC,IAAS,CAAG,CAChCpB,gBAAgB,CAACoB,IAAI,CAACrB,YAAY,CAACyB,KAAK,CAAC,GAAG,CAAC,CAAC,CAC9CJ,IAAI,CAAC,CAACK,MAAM,CAAEL,IAAI,CAACK,MAAM,CAAEC,IAAI,CAAEN,IAAI,CAACM,IAAI,CAAEC,GAAG,CAAEP,IAAI,CAACO,GAAG,CAAC,CAC1DxB,YAAY,CAACyB,OAAO,8BAAKzB,YAAY,CAACyB,OAAO,GAAER,IAAI,EAAC,CACpDlB,YAAY,CAACC,YAAY,CAACyB,OAAO,CAAC,CACpC,CAAC,CAAC,CACFtB,EAAE,CAACa,EAAE,CAAC,UAAU,CAAE,SAACC,IAAS,CAAG,CAC7BA,IAAI,CAAC,CAACK,MAAM,CAAEL,IAAI,CAACK,MAAM,CAAEC,IAAI,CAAEN,IAAI,CAACM,IAAI,CAAEC,GAAG,CAAEP,IAAI,CAACO,GAAG,CAAC,CAC1DxB,YAAY,CAACyB,OAAO,8BAAKzB,YAAY,CAACyB,OAAO,GAAER,IAAI,EAAC,CACpDlB,YAAY,CAACC,YAAY,CAACyB,OAAO,CAAC,CACpC,CAAC,CAAC,CACF,GAAMC,SAAQ,CAACC,WAAW,CAAC,UAAI,CAC7B,GAAGxB,EAAE,CAACyB,OAAO,CAAC,CACZzB,EAAE,CAAC0B,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAACT,MAAM,CAAE,WAAW,CAAEC,IAAI,CAAEV,cAAc,CAACmB,OAAO,CAAC,MAAM,CAAC,CAAEC,MAAM,CAAEpB,cAAc,CAACmB,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC9HE,aAAa,CAACR,QAAQ,CAAC,CACzB,CACF,CAAC,CAAE,CAAC,CAAC,CACP,CAAC,CAAC,EAAE,CAAC,CAELtC,KAAK,CAACoB,SAAS,CAAC,UAAI,CAClBN,cAAc,CAACuB,OAAO,CAACU,SAAS,CAAGjC,cAAc,CAACuB,OAAO,CAACW,YAAY,CACxE,CAAC,CAAC,CAACtC,QAAQ,CAAC,CAAC,CAEb,GAAMuC,SAAQ,CAAC,QAATA,SAAQ,CAAEC,CAAM,CAAG,CACvB,GAAGA,CAAC,CAACC,GAAG,GAAG,OAAO,CAChB,OACFD,CAAC,CAACE,cAAc,EAAE,CAClBrC,EAAE,CAAC0B,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAACT,MAAM,CAAE,UAAU,CAAEE,GAAG,CAAE9B,SAAS,CAAC,CAAC,CAAC,CAC7DC,aAAa,CAAC,EAAE,CAAC,CACnB,CAAC,CAED,mBACE,aAAK,SAAS,CAAC,YAAY,wBACzB,YAAK,SAAS,CAAC,aAAa,CAAC,KAAK,CAAE,CAAC8C,QAAQ,CAAE,MAAM,CAAEC,SAAS,CAAE,QAAQ,CAAE,UACzEvC,EAAE,CAACyB,OAAO,cAAE,KAAC,OAAO,EAAC,EAAE,CAAEzB,EAAG,EAAE,cAAE,kBAAK,EAClC,cACN,aAAK,SAAS,CAAC,aAAa,wBAC1B,aAAK,SAAS,CAAC,aAAa,+BACtB,aAAK,cACT,YAAK,SAAS,CAAC,cAAc,UAAEP,YAAY,EAAO,GAC9C,cACN,YAAK,SAAS,CAAC,gBAAgB,CAAC,GAAG,CAAEM,cAAe,uBAClD,KAAC,QAAQ,EAAC,QAAQ,CAAEJ,QAAS,EAAE,EAC3B,cACN,iBAAU,SAAS,CAAC,WAAW,CAAC,QAAQ,CACtC,kBAACwC,CAAC,QAAK3C,cAAa,CAAC2C,CAAC,CAAChB,MAAM,CAACqB,KAAK,CAAC,EAAC,CAAC,SAAS,CAAEN,QAAS,CAAC,WAAW,CAAC,qBAAqB,CAAC,KAAK,CAAE3C,SAAU,EAAG,GAC/G,GACF,CAEV,CAAC,CACD,cAAeF,KAAI"},"metadata":{},"sourceType":"module"}