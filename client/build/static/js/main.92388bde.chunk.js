(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{62:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var c,o=n(0),s=n.n(o),a=n(31),r=n.n(a),i=n(26),l=n(4),u=n(6),d=n(8),m=n(5),j=n(65),b=n(3),h=function(){var e=s.a.useState(""),t=Object(m.a)(e,2),n=t[0],c=t[1],o=s.a.useState(""),a=Object(m.a)(o,2),r=a[0],i=a[1],h=(Object(l.l)(),function(){var e=Object(d.a)(Object(u.a)().mark((function e(){var t;return Object(u.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=document.createElement("textarea")).value=window.location.href+"door_to_room/"+n,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("Copy"),document.body.removeChild(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());return Object(b.jsxs)("div",{className:"home",children:[Object(b.jsx)("button",{onClick:function(){j.a.get("/create_room").then((function(e){c(e.data)})).catch((function(e){alert(e.response.data.error)}))},children:"Create room"}),Object(b.jsxs)("div",{style:{display:"flex"},children:[n.length>0&&Object(b.jsx)("button",{className:"copy button",onClick:h,children:"Copy room address"}),Object(b.jsx)("textarea",{style:{resize:"none"},disabled:!0,value:n})]}),Object(b.jsx)("input",{onChange:function(e){return sessionStorage.setItem("name",e.target.value)},className:"name_box",type:"text",placeholder:"name"}),Object(b.jsx)("input",{onChange:function(e){return i(e.target.value)},className:"roomID_box",type:"text",placeholder:"room ID"}),Object(b.jsx)("button",{onClick:function(){return window.location.href="/room/".concat(r)},children:"Join room"})]})},g=n(11),p=function(){var e=new Date,t=e.getHours(),n=e.getMinutes();return"".concat(t,":").concat(n)},f=function(e){var t=e.messages;return Object(b.jsx)(b.Fragment,{children:t.map((function(e,t){return"chat_msg"===e.target?Object(b.jsxs)("div",{className:"msg",children:[Object(b.jsxs)("div",{style:{fontSize:"20px"},children:[e.name," ","(".concat(p(),")")]}),e.msg]},t):"participant"===e.target?Object(b.jsx)("div",{className:"new_participant_msg",children:"".concat(e.name," ").concat(e.msg)},t):{}}))})},O=s.a.memo(f),x=n(9),v=n(10),w=function(){function e(t){var n=this;Object(x.a)(this,e),this.targets=void 0,this.ws=void 0,this.is_open=void 0,this.ws=new WebSocket(t),this.targets=new Map,this.is_open=!1,this.ws.onopen=function(){n.is_open=!0},this.ws.onclose=function(e){console.log(e)},this.ws.onerror=function(e){console.log(e)},this.ws.onmessage=function(e){var t=JSON.parse(e.data);n.targets.get(t.target)(t)}}return Object(v.a)(e,[{key:"on",value:function(e,t){this.targets.set(e,t)}},{key:"send",value:function(e){this.ws.send(e)}}]),e}(),_=n(34),N=new Map,y=function(e){var t=e.ws,n=s.a.useRef(),o=s.a.useState(!1),a=Object(m.a)(o,2),r=a[0],i=a[1],l=s.a.useState(!1),u=Object(m.a)(l,2),d=u[0],j=u[1],h=function(){var e=c.getVideoTracks()[0].enabled;c.getVideoTracks()[0].enabled=!e,i(!r)},g=function(){var e=c.getAudioTracks()[0].enabled;c.getAudioTracks()[0].enabled=!e,j(!d)},p=function(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),n.current.append(e)};return s.a.useEffect((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){c=e;var n,o=document.createElement("video");o.muted=!0,p(o,e),t.on("uuid",(function(c){(n=new _.a(c.uuid)).on("call",(function(t){console.log("Call from a peer"),t.answer(e);var n=document.createElement("video");t.on("stream",(function(e){p(n,e)}))})),n.on("open",(function(e){console.log("You joined room as "+e),t.send(JSON.stringify({target:"new_peer",peerID:e}))}))})),t.on("new_peer",(function(t){console.log("you called a new peer");var c=n.call(t.peerID,e),o=document.createElement("video");c.on("stream",(function(e){p(o,e)})),c.on("close",(function(){o.remove()})),N.set(t.peerID,c)})),t.send(JSON.stringify({target:"uuid"}))})).catch((function(e){console.error("Failed to get local stream",e)})),t.on("peer_disconnected",(function(e){console.log("peer left"),N.get(e.peerID).close(),N.delete(e.peerID)}))}),[t]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("div",{className:"video_grid",ref:n}),Object(b.jsxs)("div",{className:"controller",children:[Object(b.jsxs)("div",{className:"stream_control_block",children:[r?Object(b.jsxs)("div",{onClick:h,className:"play stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/video.webp",alt:""}),Object(b.jsx)("span",{children:"Play Video"})]}):Object(b.jsxs)("div",{onClick:h,className:"stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/video.webp",alt:""}),Object(b.jsx)("span",{children:"Stop Video"})]}),d?Object(b.jsxs)("div",{onClick:g,className:"unmute stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/mic.webp",alt:""}),Object(b.jsx)("span",{children:"Unmute"})]}):Object(b.jsxs)("div",{onClick:g,className:"stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/mic.webp",alt:""}),Object(b.jsx)("span",{children:"Mute"})]})]}),Object(b.jsxs)("div",{className:"stream_control_block",children:[Object(b.jsxs)("div",{className:"stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/participants.webp",alt:""}),Object(b.jsx)("span",{children:"Participants"})]}),Object(b.jsxs)("div",{className:"stream_control_button",children:[Object(b.jsx)("img",{src:"/icons/chat.webp",alt:""}),Object(b.jsx)("span",{children:"Chat"})]})]}),Object(b.jsx)("div",{onClick:function(){t.ws.close(),window.location.href="/"},className:"leave_meetig stream_control_button",children:Object(b.jsx)("span",{children:"Leave Meeting"})})]})]})},S=function(){var e=s.a.useState(""),t=Object(m.a)(e,2),n=t[0],c=t[1],o=s.a.useState([]),a=Object(m.a)(o,2),r=a[0],i=a[1],l=s.a.useState([]),u=Object(m.a)(l,2),d=u[0],j=u[1],h=s.a.useRef([]),p=s.a.useRef(),f=s.a.useMemo((function(){return new w("wss://".concat(window.location.hostname))}),[]);s.a.useEffect((function(){for(var e=window.location.href,t=e.length-1;"/"!==e[t];)t--;sessionStorage.setItem("roomID",e.substring(t+1,e.length)),f.on("err",(function(e){alert("Multiple connections not allowed!"),console.log(e)})),f.on("participant",(function(e){i(e.participants.split("/")),e={target:e.target,name:e.name,msg:e.msg},h.current=[].concat(Object(g.a)(h.current),[e]),j(h.current)})),f.on("chat_msg",(function(e){e={target:e.target,name:e.name,msg:e.msg},h.current=[].concat(Object(g.a)(h.current),[e]),j(h.current)}));var n=setInterval((function(){f.is_open&&(f.send(JSON.stringify({target:"join_room",name:sessionStorage.getItem("name"),roomID:sessionStorage.getItem("roomID")})),clearInterval(n))}),1)}),[]),s.a.useEffect((function(){p.current.scrollTop=p.current.scrollHeight}),[d]);return Object(b.jsxs)("div",{className:"room_frame",children:[Object(b.jsx)("div",{className:"left_window",style:{fontSize:"50px",textAlign:"center"},children:f.is_open?Object(b.jsx)(y,{ws:f}):Object(b.jsx)(b.Fragment,{})}),Object(b.jsxs)("div",{className:"chat_window",children:[Object(b.jsxs)("div",{className:"chat_header",children:["Chat",Object(b.jsx)("br",{}),Object(b.jsx)("div",{className:"participants",children:r})]}),Object(b.jsx)("div",{className:"message_window",ref:p,children:Object(b.jsx)(O,{messages:d})}),Object(b.jsx)("textarea",{className:"msg_input",onChange:function(e){return c(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),f.send(JSON.stringify({target:"chat_msg",msg:n})),c(""))},placeholder:"target message here",value:n})]})]})},k=function(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("input",{onChange:function(e){return sessionStorage.setItem("name",e.target.value)},className:"name_box",type:"text",placeholder:"name",style:{fontSize:"30px"}}),Object(b.jsx)("button",{className:"join room button",onClick:function(){return window.location.href="/room/".concat(function(){for(var e=window.location.href,t=e.length-1;"/"!==e[t];)t--;return e.substring(t+1,e.length)}())},style:{fontSize:"30px"},children:"Join room"})]})};n(62);function C(){return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(i.a,{children:Object(b.jsxs)(l.c,{children:[Object(b.jsx)(l.a,{path:"/",element:Object(b.jsx)(h,{})}),Object(b.jsx)(l.a,{path:"/door_to_room/*",element:Object(b.jsx)(k,{})}),Object(b.jsx)(l.a,{path:"/room/*",element:Object(b.jsx)(S,{})})]})})})}r.a.createRoot(document.getElementById("root")).render(Object(b.jsx)(C,{}))}},[[63,1,2]]]);
//# sourceMappingURL=main.92388bde.chunk.js.map